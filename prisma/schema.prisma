// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Supervisor {
  id            Int            @id @default(autoincrement())
  name          String
  email         String         @unique
  phone         String         @unique
  googleScholar String
  experience    Educational[]
  students      User[]
  Conversation  Conversation[]
}

model Verification {
  id             Int      @id @default(autoincrement())
  email          String   @unique
  try            Int      @default(0)
  code           String
  lastResendTime DateTime
}

model Educational {
  id           Int         @id @default(autoincrement())
  title        String
  level        String
  university   String
  Supervisor   Supervisor? @relation(fields: [supervisorId], references: [id])
  supervisorId Int?
}

model User {
  id            Int            @id @default(autoincrement())
  name          String?
  email         String
  field         String?
  studentNumber String?
  nationalCode  String         @unique
  status        Status         @default(studying)
  role          Role           @default(student)
  password      String?
  seminar       Seminar        @relation(fields: [seminarId], references: [id])
  supervisor    Supervisor[]
  Conversation  Conversation[]
  profile       Profile?       @relation(fields: [profileId], references: [id])
  profileId     Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  seminarId Int
}

enum Role {
  student
  admin
}

enum Status {
  studying
  graduated
  dismissal
}

model Conversation {
  id           Int                @id @default(autoincrement())
  title        String
  status       ConversationStatus @default(open)
  messages     Messages[]
  student      User               @relation(fields: [studentId], references: [id])
  supervisor   Supervisor         @relation(fields: [supervisorId], references: [id])
  studentId    Int
  supervisorId Int

  createdAt DateTime @default(now())
}

enum ConversationStatus {
  open
  closed
}

model Messages {
  id             Int           @id @default(autoincrement())
  text           String
  file           String?
  sender         Sender
  Conversation   Conversation? @relation(fields: [conversationId], references: [id])
  conversationId Int?
}

enum Sender {
  student
  supervisor
}

model Profile {
  id                Int      @id @default(autoincrement())
  fatherName        String
  marital           Boolean  @default(false)
  BirthDay          DateTime
  address           String
  phone             String
  fieldOfStudy      String
  orientation       String
  enteringYear      Int
  beforeUniversity  String
  dissertationTopic String
  numberOfArticls   Int
  seminarTopic      String?

  User User[]
}

model Seminar {
  id             Int      @id @default(autoincrement())
  title          String
  description    String
  listOfArticles String[]
  progress       Int      @default(0)
  User           User[]
}
